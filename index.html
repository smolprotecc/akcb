<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>A Kid Called Beast - Playgrounds</title>
  <style>
    html, body {
      overflow: hidden;
      width   : 100%;
      height  : 100%;
      margin  : 0;
      padding : 0;
    }
    #renderCanvas {
      width : 100%;
      height: 100%;
      touch-action: none;
    }
  </style>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  <script src="akcbBabylon.js"></script>
  <script src="akcbPlaygrounds.js"></script>
</head>
<body>
  <canvas id="renderCanvas"></canvas>
</body>
<script>
	
let glbURL      = 'https://cloudflare-ipfs.com/ipfs/QmNRK6ijPiNmsKiGxVRhTGczUEAFmAGVMNCgZqN4wzTkrT/FILENUMBER.glb'
let metadataURL = 'https://cloudflare-ipfs.com/ipfs/QmRiP1c1j5Lobzb6SpP5pJfC1kyHjnGyGNRg5kfgiUTgSD/FILENUMBER'
	
let scene;
		
document.addEventListener("DOMContentLoaded", async function(event) {
  akcbBabylon.setup()
  scene = await akcbBabylon.defaultScene()
	
  akcbPlaygrounds.start()
	
  let uri = glbURL.replace('FILENUMBER','6262')
  let asset = await fetch(uri).then((res) => {
    return res.body
  }).then((body) => {
    const reader = body.getReader()
    return new ReadableStream({
      start(controller) {
        return pump()
        function pump() {
          return reader.read().then(({done, value}) => {
            if (done) {
              controller.close()
              return
            }
            controller.enqueue(value)
            return pump()
          })
        }
      }
    })
  })
  .then((stream) => new Response(stream))
  .then((res) => res.blob())
  .then((blob) => URL.createObjectURL(blob))
  .then((url) => {
     return url
  })
  
  console.log(asset)
	
  await BABYLON.SceneLoader.AppendAsync(asset, undefined, scene, undefined, ".glb");
})
</script>
</html>
